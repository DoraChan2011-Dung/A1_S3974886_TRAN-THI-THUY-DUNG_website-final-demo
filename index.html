<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>My beautiful little Fluff</title>

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- Background music ‚Äì starts on click, loops across sections -->
    <audio id="bg-music" src="assets/audio/piano-loop.mp3" loop></audio>

    <!-- Global Moon (fixed, across section 2 & 3) -->
    <div id="globalMoon" class="global-moon">
      <img
        src="assets/Moon_parralax_section 2 + 3.webp"
        alt="Moon"
        class="moon-2"
      />
    </div>

    <main>
      <!-- ====================== SECTION 1 ‚Äî INTRO ====================== -->
      <section id="intro" class="hero">
        <div class="hero-inner">
          <!-- Base background color texture -->
          <img
            src="assets/Background color_section 1.png"
            alt="Soft cloudy background"
            class="hero-layer full-frame layer-bg"
          />

          <!-- Extra background details -->
          <img
            src="assets/Background detail (1) _section 1.webp"
            alt=""
            class="hero-layer full-frame layer-detail-1"
          />
          <img
            src="assets/Background detail (2) _section 1.webp"
            alt=""
            class="hero-layer full-frame layer-detail-2"
          />
          <img
            src="assets/Background detail (3) _section 1.webp"
            alt=""
            class="hero-layer full-frame layer-detail-3"
          />

          <!-- Rabbit highlight halo -->
          <img
            src="assets/Rabbit Highlight section 1.webp"
            alt=""
            class="hero-layer full-frame layer-rabbit-highlight"
          />

          <!-- Main rabbit -->
          <img
            src="assets/Rabbit png section 1.webp"
            alt="White rabbit looking sideways"
            class="hero-layer full-frame layer-rabbit"
          />

          <!-- Click frame -->
          <img
            src="assets/Click to Start frame.webp"
            alt="Decorative frame"
            class="layer-frame"
          />

          <!-- Butterfly GIF -->
          <img
            src="assets/Butterfly GIF section 1.gif"
            alt="Animated butterfly"
            class="layer-butterfly"
          />

          <!-- Text block that sits on top of the frame -->
          <div class="hero-text">
            <h1 id="titleButton" class="title-button">Click to Start</h1>
          </div>
        </div>
      </section>

      <!-- ====================== SECTION 2 ‚Äî FOREST SCENE ====================== -->
      <section id="section2" class="scene scene-2">
        <div class="scene-inner">
          <!-- Background -->
          <img
            src="assets/color background_section 2.webp"
            alt="Forest background"
            class="layer full-frame bg-2"
          />

          <!-- Tree shadow -->
          <img
            src="assets/Tree shadow_section 2.webp"
            alt="Tree shadow"
            class="layer tree-shadow-2"
          />

          <!-- Main tree -->
          <img
            src="assets/Tree_section 2.webp"
            alt="Tree"
            class="layer tree-2"
          />

          <!-- Bushes (section 2) -->
          <img
            src="assets/bush 1 parralax_section 2+3.gif"
            alt="Bush 1"
            class="layer bush-2 bush1-2"
          />

          <img
            src="assets/bush 2 parralax_section 2+3.gif"
            alt="Bush 2"
            class="layer bush-2 bush2-2"
          />

          <img
            src="assets/bush 3 parralax_section 2+3.gif"
            alt="Bush 3"
            class="layer bush-2 bush3-2"
          />

          <!-- Rabbit (behind only bush3) -->
          <img
            src="assets/Rabbit_section 2.gif"
            alt="Jumping rabbit"
            class="layer rabbit-2"
          />

          <!-- Ground (Ground section 2) -->
          <img
            src="assets/ground 1_section 2+3.webp"
            alt="ground_section 2"
            class="layer ground_section2"
          />

          <!-- Title on moon -->
          <div class="scene2-text">
            <h2 class="scene2-title">My Beautiful little <span class="title-fluff">Fluff</span>
            </h2>
            <p class="scene2-subtitle">A poem generated by AI</p>
          </div>
        </div>
      </section>

      <!-- ====================== SECTION 3 ‚Äî Rabbit House ====================== -->
      <section id="section3" class="scene scene-3">
        <div class="scene-inner">
          <!-- Background -->
          <img
            src="assets/color background_section 3 2.webp"
            alt="Forest background 3"
            class="layer full-frame bg-3"
          />

          <!-- Ground (Ground section 3) -->
          <img
            src="assets/ground 1_section 2+3.webp"
            alt="ground_section 3"
            class="layer ground_section3"
          />

          <!-- Ground 2 (section 3)-->
          <img
            src="assets/ground 2_section 3.webp"
            alt="ground 2_section 3"
            class="layer ground2_section3"
          />

          <!--- Tree forest (section 3) -->
          <img
            src="assets/Tree forest_section 3.webp"
            alt="Tree forest"
            class="layer tree-forest-3"
          />

        <div class="rabbit-house-3-wrapper">
          <img
            src="assets/Rabbit house GIF_section 3.gif"
            alt="Rabbit house"
            class="rabbit-house-3-img"
          />

          <!-- Poem line 2 -->
          <p class="poem-line-2-hover"> A rabbit girl, <span class="bright-style"> bright as morning bells,</span></p>
        </div>

          <!-- Rabbit Dad and Daughter (section3)-->
          <img
            src="assets/Rabbit Dad and Daughter_ section 3.webp"
            alt="Rabbit dad and daughter"
            class="layer rabbit-dad-daughter-3"
          />

          <!-- Bushes (section3) -->
          <div class="bush1-3-wrapper">
            <img
              src="assets/bush 1 parralax_section 2+3.gif"
              alt="Bush 1"
              class="layer bush-3 bush1-3-img"
            />

            <!-- Poem line 1 ‚Äì hi·ªán khi hover -->
            <p class="poem-line-1">
              <span class="small-style">A smallmoss-</span> soft home.
            </p>
            </div>

            <img
            src="assets/bush 2 parralax_section 2+3.gif"
            alt="Bush 2"
            class="layer bush-3 bush2-3"
            />

          <img
            src="assets/bush 3 parralax_section 2+3.gif"
            alt="Bush 3"
            class="layer bush-3 bush3-3"
          />

          <!-- Poem 2nd(2) sentences -->
          <div class="poem-text-2" id="poemText">
            <p class="poem-line-2a">
              Living in a world <span class="without-shadow">without shadow.</span>
            </p>
          </div>
          
          <!-- Invisible trigger barrier for blur animation -->
          <div id="poemTrigger" style="position: absolute; width: 100%; height: 1px; bottom: 20%; pointer-events: none;"></div>
        </div>
      </section>


          <!-- ====================== SECTION 4  ====================== -->
      <section id="section4" class="scene scene-4">
           <div class="scene-inner">
          <!-- üîπ Canvas p5 trong su·ªët n·∫±m ƒë√® l√™n background section 4 -->
          <div id="section4-canvas"></div>

          <!-- Background section 4 -->
            <img
              src="assets/background_section 4.webp"   
              alt="Deep forest background"
              class="layer full-frame bg-4"
            />
        <!-- Butterfly GIF Section 4 -->
            <div class="bush1-3-wrapper">
            <img
              src="assets/Butterfly GIF section 1.gif"
              alt="Butterfly section 4"
              class="layer butterfly-4"
            />
            </div> 

            <!-- p5 canvas n·∫øu c√≥ -->
            <div id="loading-canvas"></div>

            <!-- FOOTPRINT ƒë∆°n gi·∫£n -->
            <img
              src="assets/footprint_section 4.webp"
              alt="Rabbit footprints"
              class="layer footprints-4"
            />
          </div>

        <!-- poem text line 4-->
        <section class="poem-text-4-section">
          <div class="poem-text-4-wrapper">
            <p class="poem-line-4">
              One night the wind trembled.
            </p>
          </div>

        <!-- poem text line 5-->
          <div class="poem-text-5-wrapper">
            <p class="poem-line-5">
              The moon whispered warning.
            </p>
          </div>

        <!-- poem text line 6-->
          <div class="poem-text-6-wrapper">
            <p class="poem-line-6">
              A wolf found <span class="footprint-style">her footprints,</span> cold breath of winter.
            </p>
          </div>
        </section>
      </section>

      <!-- ====================== SECTION 5 ====================== -->
      <section id="section5" class="scene scene-5">
        <div class="scene-inner-5">
          
          <!-- Background Section 5 -->
          <img 
            src="assets/Backgroung_section 5.webp"
            alt="Background section 5"
            class="bg-5"
          />

          <!-- Vein sketch canvas Section 5 -->
            <div id="section5-veins" class="veins-layer"></div>

          <!-- Poem lines -->
          <p class="poem5-line-7-8-9">
            Before <span class="darkness-style">drakness</span> closed, her father ran.
            Heart burning, feet <span class="bleeding-style">bleeding</span>
            not strength, but <span class="love-style">love</span> carried him forward.
          </p>

          <!-- Dad rabbit heart Section 5-->
          <img
            src="assets/Dad heart_section 5.gif"
            alt="Dad rabbit heart"
            class="dad-heart-5"
          /> 
        </div>

          <!-- LEFT eye GIF Section 5-->
          <img
            src="assets/left eye GIF_section 5.gif"
            alt="Left eye GIF"
            class="left-eye-5"
          />
          
          <!-- RIGHT eye GIF Section 5-->
          <img
            src="assets/right eye GIF_section 5.gif"
            alt="Right eye GIF"
            class="right-eye-5"
          />
      </section>

      <!-- ====================== SECTION 6 ====================== -->
      <section id="section6" class="scene scene-6">
        <div class="scene-inner-6"
          id="poem6Trigger"
            style="
              position: absolute;
              width: 100%;
              height: 1px;
              bottom: 35%;
              left: 0;
              pointer-events: none;
            "></div>

      <!-- Vein sketch canvas Section 6 -->
        <div id="section6-veins" class="veins-layer"></div>
          
          <!-- Background Section 6 -->
          <img 
            src="assets/Backgroung_section 5.webp"
            alt="Background section 6"
            class="bg-6"
          />

          <!-- wave 1 section 6-->
          <img
            src="assets/wave 1_section 6.webp"
            alt="wave 1 section 6"
            class="wave1-6"
          />

          <!-- wave 2 section 6-->
          <img
            src="assets/wave 2_section 6.webp"
            alt="wave 2 section 6"
            class="wave2-6"
          />

          <!-- wolf section 6-->
          <img
            src="assets/wolf_section 6.gif"
            alt="wolf section 6"
            class="wolf-6"
          />

          <!-- Dad rabbit hand section 6 -->
          <img
            src="assets/Dad rabbit hand_section 6.webp"
            alt="Dad rabbit hand section 6"
            class="dad-hand-6"
          />

          <!-- Poem line 10-section 6-->
          <p class="poem6-line-10">
            Between moonlight and shadow,<span class="met-style">they met.</span>
          </p>

          <!-- Poem line 11-12-section 6-->
          <p class="poem6-line-11-12">
            Love turned into flame as he fought for her smile 
            but cruelty struck harder.
          </p>

          <div id="poem6Trigger" style="position:absolute; bottom:40%; width:100%; height:1px;"></div>

          <!-- Trigger cho text line 10 & 11 -->
          <div id="poem6Trigger"></div>
        </div>
      </section>
      
      <!-- ====================== SECTION 7 ====================== -->
      <section id="section7" class="scene scene-7">
        <div class="scene-inner-7">
          <!-- Background Section 7 -->
          <img 
            src="assets/Dad and daughter after life GIF_section 7.webp"
            alt="Background section 7"
            class="bg-7"
          />

          <!-- blur filter_section 6 -->
           <img
            src="assets/blur filter_section 6.png"
            alt="blur filter section 7"
            class="blur-filter-7"
          />

          <!-- the battle GIF_section 7-->
          <div class="the-battle-7-wrapper">
            <img 
              src="assets/the battle GIF_section 7.gif"
              alt="The Battle"
              class="the-battle-7"
            />
          </div>

          <!-- Poem line 13-14-15-16 -->
          <p class="poem7-line-13-14-15-16">
            In the quiet afterlight, he held her close:
            ‚ÄúI‚Äôm here now.
            No nightmare can reach you.
            Rest, little one.‚Äù
          </p>
        </div>
      </section>

      <!-- ====================== SECTION 8 ====================== -->
      <section id="section8" class="scene scene-8">
        <div class="scene-inner-8">
          <!-- Backgroung_section 8+9 -->
          <img 
            src="assets/Backgroung_section 8+9.webp"
            alt="Background section 8"
            class="bg-8"
          />

          <!-- Sketch 3 canvas g·∫Øn v√†o ƒë√¢y -->
          <div id="section8-words" class="words-layer"></div>
        </div>
      </section>

      <!-- ====================== SECTION 9 ====================== -->
      <section id="section9" class="scene scene-9">
        <div class="scene-inner-9">
          <!-- Background_section 8+9 -->
          <img 
            src="assets/Backgroung_section 8+9.webp"
            alt="Background section 9"
            class="bg-9"
          />

          <!-- wolf die GIF_section 9 -->
          <img
            src="assets/wolf die GIF_section 9.gif"
            alt="wolf die GIF section 9"
            class="wolf-die-9"
          />
        </div>

          <!-- scales of justice_section 9 -->
          <img
            src="assets/scales of justice_section 8+9.gif"
            alt="scales of justice section 9"
            class="scales-9"
          />

        <!-- wave section 9-->
        <img
          src="assets/wave 2_section 6.webp"
          alt="wave section 9"
          class="wave-9"
        />

        <!-- Poem line 17-18-19-->
        <p class="poem9-line-17-18-19">
          <span class="poem9-line-1">
            Far away, the wolf fell under a hunter‚Äôs arrow.
          </span><br>
          Cruelty carries its debt.<br>
          <span class="justice-style">Even darkness must kneel to justice.</span>
        </p>
      </section>
    </main>

    <!-- ====================== JS INTERACTION ====================== -->
    <script>
      // Grab DOM elements
      const titleBtn = document.getElementById("titleButton");
      const section2 = document.getElementById("section2"); 
      const bgMusic = document.getElementById("bg-music");

      // Handle click on the title line
      if (titleBtn) {
        titleBtn.addEventListener("click", () => {
        // Add / restart a tiny "click" animation class
        titleBtn.classList.remove("clicked");
        void titleBtn.offsetWidth;          // Force reflow so animation can replay
        titleBtn.classList.add("clicked");

        // Smooth scroll to SECTION 2
        section2.scrollIntoView({ behavior: "smooth" });
        // Try to start the background music.
        if (bgMusic && bgMusic.paused) {
          bgMusic
            .play()
            .catch((err) => console.log("Audio play was blocked:", err));
        }
        });
      }

      /* ================= GLOBAL MOON PARALLAX (SECTION 2 + 3) ================= */
      const globalMoon = document.getElementById("globalMoon");
      const section3 = document.getElementById("section3");
      const section4 = document.getElementById("section4"); // n·∫øu ch∆∞a c√≥ th√¨ s·∫Ω = null
      const ground3  = document.querySelector(".ground_section3"); // üëà NEW: ground section 3

      window.addEventListener("scroll", () => {
        if (!globalMoon || !section2 || !section3) return;

        const scrollY = window.scrollY;

        // Moon b·∫Øt ƒë·∫ßu xu·∫•t hi·ªán t·ª´ ƒë·∫ßu section 2
        const start = section2.offsetTop;

        // --- ƒêI·ªÇM D·ª™NG M·ªöI: khi moon ch·∫°m ground_section3 ---
        let end;

        if (ground3) {
          // v·ªã tr√≠ top c·ªßa ground_section3 so v·ªõi document
          const groundTop =
            ground3.getBoundingClientRect().top + window.scrollY;

          // d·ª´ng khi "ƒë√°y" c·ªßa moon ch·∫°m "ƒë·ªânh" c·ªßa ground
          const moonHeight = globalMoon.offsetHeight || 0;
          end = groundTop - moonHeight * -0.3;
        } else {
          // fallback: n·∫øu ch∆∞a c√≥ ground_section3 th√¨ d√πng logic c≈©
          const section3Bottom = section3.offsetTop + section3.offsetHeight;
          const section4Top = section4 ? section4.offsetTop : section3Bottom;
          end = section4Top - window.innerHeight * 0.2;
        }

        // N·∫øu ch∆∞a t·ªõi section 2: ·∫©n moon + reset v·ªã tr√≠
        if (scrollY < start) {
          globalMoon.style.opacity = "0";
          globalMoon.style.transform = "translate(-50%, 0px)";
          return;
        }

        // N·∫øu ƒë√£ v∆∞·ª£t qua ƒëi·ªÉm d·ª´ng: gi·ªØ v·ªã tr√≠ cu·ªëi + fade out d·∫ßn
        if (scrollY > end) {
          const speed = 0.25; // gi·ªØ nguy√™n t·ªëc ƒë·ªô
          const maxOffset = (end - start) * speed;
          globalMoon.style.transform = `translate(-50%, ${maxOffset}px)`;
          globalMoon.style.opacity = "0";
          return;
        }

        // Trong v√πng ho·∫°t ƒë·ªông: parallax b√¨nh th∆∞·ªùng
        const speed = 0.25;
        const offset = (scrollY - start) * speed;

        globalMoon.style.opacity = "1";
        globalMoon.style.transform = `translate(-50%, ${offset}px)`;
      });

      /* ================= BLUR TO CLEAR ANIMATION WITH INTERSECTION OBSERVER ================= */
      const poemText = document.getElementById("poemText");
      const poemTrigger = document.getElementById("poemTrigger");
      
      const observerOptions = {
        root: null,
        rootMargin: "100px 0px 100px 0px", // Trigger khi barrier g·∫ßn v√†o viewport
        threshold: 0
      };
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            poemText.classList.add("visible");
          } else {
            poemText.classList.remove("visible");
          }
        });
      }, observerOptions);
      
      if (poemTrigger) {
        observer.observe(poemTrigger);
      }

      /* ==== SECTION 6 TEXT OBSERVER (RI√äNG) ==== */

      const poem6Line10 = document.querySelector(".poem6-line-10");
      const poem6Line11 = document.querySelector(".poem6-line-11-12");
      const poem6Trigger = document.getElementById("poem6Trigger");

      if (poem6Trigger) {
        const observer6 = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                poem6Line10?.classList.add("visible");
                poem6Line11?.classList.add("visible");
              } else {
                // N·∫øu mu·ªën khi scroll ng∆∞·ª£c l√™n th√¨ m·ªù ƒëi l·∫°i, gi·ªØ l·∫°i ƒëo·∫°n d∆∞·ªõi
                poem6Line10?.classList.remove("visible");
                poem6Line11?.classList.remove("visible");
              }
            });
          },
          {
            root: null,
            rootMargin: "100px 0px 100px 0px",
            threshold: 0,
          }
        );

        observer6.observe(poem6Trigger);
      }

    /* ========== SECTION 7 ‚Äì CLICK TO REVEAL BACKGROUND ========== */
        const section7      = document.getElementById("section7");
        const battleWrapper = document.querySelector(".the-battle-7-wrapper");

        if (section7 && battleWrapper) {
          battleWrapper.addEventListener("click", () => {
            // th√™m class ƒë·ªÉ k√≠ch ho·∫°t CSS fade-out
            section7.classList.add("section7-reveal");
          });
        }

    document.addEventListener('DOMContentLoaded', () => {
    // 1. Khai b√°o c√°c ph·∫ßn t·ª≠ c·∫ßn thi·∫øt
    const scales8 = document.querySelector('.scales-8');
    const section8 = document.getElementById('section8');
    const section9 = document.getElementById('section9'); // C·∫ßn c√≥ ID n√†y trong HTML
    
    // T·ªëc ƒë·ªô Parallax (gi·ªØ 0.3 nh∆∞ ƒë√£ th·ªëng nh·∫•t)
    const PARALLAX_SPEED = 0.3; 

    if (!scales8 || !section8) return; // Tho√°t n·∫øu thi·∫øu ph·∫ßn t·ª≠ c∆° b·∫£n

    window.addEventListener("scroll", () => {
        const scrollY = window.scrollY;

        // V·ªã tr√≠ b·∫Øt ƒë·∫ßu Parallax: ƒê·∫ßu section 8
        const start = section8.offsetTop;

        // V·ªã tr√≠ k·∫øt th√∫c Parallax: Cu·ªëi section 9
        let end;
        if (section9) {
            // ƒêi·ªÉm k·∫øt th√∫c l√† bottom c·ªßa section 9
            end = section9.offsetTop + section9.offsetHeight;
        } else {
            // Fallback n·∫øu section 9 ch∆∞a ƒë∆∞·ª£c khai b√°o
            end = section8.offsetTop + section8.offsetHeight;
        }

        // --- 1. TR∆Ø·ªöC V√ôNG HO·∫†T ƒê·ªòNG (Tr∆∞·ªõc Section 8) ---
        if (scrollY < start) {
            // ƒê·∫∑t l·∫°i v·ªã tr√≠ ban ƒë·∫ßu (c·∫ßn translate-50% ƒë·ªÉ cƒÉn gi·ªØa)
            scales8.style.transform = "translate(-50%, -50%)";
            return;
        }
      });
    });
      </script>

    <!-- p5.js library + generative sketch -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="sketch.js"></script>
    <script src="sketch2.js"></script>
    <script src="sketch3.js"></script>
  </body>

</html>

